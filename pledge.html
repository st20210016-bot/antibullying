<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kindness Pledge â€“ SAIS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="page">

  <nav class="navbar">
    <div class="nav-logo">
      <a href="index.html"><img src="images.jpeg" alt="SAIS Logo"></a>
      <span>SAIS</span>
    </div>
    <ul class="nav-links">
      <li><a href="about.html">About</a></li>
      <li><a href="impact.html">Impact</a></li>
      <li><a href="types.html">Types</a></li>
      <li><a href="stop.html">Stop Bullying</a></li>
      <li><a href="uae.html">UAE Law</a></li>
      <li><a href="kinder.html">Kinder World</a></li>
      <li><a href="policy.html">School Policy</a></li>
      <li><a href="pledge.html" class="active">Pledge</a></li>
      <li><a href="report.html">Report Bullying</a></li>
    </ul>
  </nav>

  <header class="hero fade-up">
    <h1>SAIS Kindness & Anti-Bullying Pledge</h1>
    <p>One click is a promise to stand up, speak out, and support others.</p>
    <div class="hero-tags">
      <span class="tag-pill">Commitment</span>
      <span class="tag-pill">Respect</span>
      <span class="tag-pill">Action</span>
    </div>
  </header>

  <main class="main-content">

    <section class="card fade-up delay-1">
      <h2>Make Your Pledge</h2>
      <p>
        By taking this pledge, you are promising to help make SAIS a safe and welcoming place
        for everyone. Your pledge is recorded in a shared counter so our whole school community
        can see how many students have committed to kindness.
      </p>

      <div id="pledge-counter" class="pledge-counter">
        ðŸ’™ <strong id="pledge-number">50</strong> students have taken the pledge so far.
      </div>

      <div style="margin-top:8px; display:flex; flex-wrap:wrap; gap:10px;">
        <button id="pledge-kindness" class="btn-primary">
          I Pledge to Be Kind
        </button>
        <button id="pledge-standup" class="btn-outline">
          I Pledge to Stand Up Against Bullying
        </button>
      </div>

      <p id="pledge-message" class="success-message" style="display:none; margin-top:14px;">
        âœ… Thank you for taking the pledge. Your choice has been recorded.
      </p>
    </section>

    <section class="card fade-up delay-2">
      <h2>What This Pledge Means</h2>
      <ul>
        <li>I will treat others with respect, both in person and online.</li>
        <li>I will not join in with bullying, teasing, or spreading rumours.</li>
        <li>I will support classmates who are being left out or targeted.</li>
        <li>I will report bullying to a trusted adult at school.</li>
        <li>I will think carefully before I post, comment, or share anything online.</li>
      </ul>
    </section>

  </main>

  <footer>
    Â© 2024 SAIS Anti-Bullying Campaign
  </footer>

  <script>
    const btnKind = document.getElementById('pledge-kindness');
    const btnStand = document.getElementById('pledge-standup');
    const msg = document.getElementById('pledge-message');
    const pledgeNum = document.getElementById('pledge-number');

    // ðŸ”¹ FILL THESE IN WITH YOUR REAL VALUES ðŸ”¹
    const BIN_ID = '691b514743b1c97be9b38322';          // e.g. '66f1234567890abcd'
    const MASTER_KEY = '$2a$10$/HRjC7rGM4sRC4wsfJKDI.T.KHbT8LLqWuBQ9YpXZafxgoQTvPhnW';  // your X-Master-Key from JSONBin

    const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const STARTING_PLEDGES = 50;

    let totalPledges = STARTING_PLEDGES;
    let alreadyPledged = localStorage.getItem('saisPledgeTaken') === 'true';

    function lockButtons() {
      msg.style.display = 'block';
      btnKind.textContent = 'Pledge Completed âœ”';
      btnStand.textContent = 'Pledge Completed âœ”';
      btnKind.disabled = true;
      btnStand.disabled = true;
      btnKind.style.opacity = '0.8';
      btnStand.style.opacity = '0.8';
    }

    // Load global pledges from JSONBin
    async function loadPledges() {
      try {
        const res = await fetch(BIN_URL, {
          headers: {
            'X-Master-Key': MASTER_KEY
          }
        });
        const data = await res.json();
        // JSONBin v3 returns { record: { pledges: ... }, ... }
        totalPledges = (data.record && typeof data.record.pledges === 'number')
          ? data.record.pledges
          : STARTING_PLEDGES;

        pledgeNum.textContent = totalPledges;
      } catch (err) {
        console.error('Error loading pledges:', err);
        pledgeNum.textContent = totalPledges;
      }

      if (alreadyPledged) {
        lockButtons();
      }
    }

    // Update global pledges in JSONBin
    async function updatePledges() {
      const newTotal = totalPledges + 1;

      try {
        const res = await fetch(BIN_URL, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': MASTER_KEY
          },
          body: JSON.stringify({ pledges: newTotal })
        });

        if (!res.ok) {
          throw new Error('Failed to update bin');
        }

        totalPledges = newTotal;
        pledgeNum.textContent = totalPledges;
      } catch (err) {
        console.error('Error updating pledges:', err);
        alert('There was a problem saving your pledge. Please try again later.');
      }
    }

    async function takePledge() {
      if (alreadyPledged) {
        lockButtons();
        return;
      }

      await updatePledges();

      alreadyPledged = true;
      localStorage.setItem('saisPledgeTaken', 'true');
      lockButtons();
    }

    btnKind.addEventListener('click', takePledge);
    btnStand.addEventListener('click', takePledge);

    // Load initial value when page opens
    loadPledges();
  </script>

</body>
</html>
